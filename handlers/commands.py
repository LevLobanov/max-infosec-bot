from maxapi.types import MessageCreated
from maxapi.context import MemoryContext
import logging
from handlers.groups import start_group_check_session
from handlers.utils import get_chat_type

logger = logging.getLogger(__name__)


async def handle_start(event: MessageCreated, context: MemoryContext):
    await context.clear()
    await event.message.answer(
        "üõ°Ô∏è AntiScam Bot MAX\n\n"
        "–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –¥–∏–∞–ª–æ–≥–∏ –Ω–∞ –ø—Ä–∏–∑–Ω–∞–∫–∏ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞\n\n"
        "üí¨ –í –õ–ò–ß–ù–´–• –°–û–û–ë–©–ï–ù–ò–Ø–•:\n"
        "‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /check —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π\n"
        "‚Ä¢ –ü—Ä–∏—Å—ã–ª–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–º—É\n"
        "‚Ä¢ –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞\n\n"
        "üë• –í –ì–†–£–ü–ü–û–í–´–• –ß–ê–¢–ê–•:\n"
        "‚Ä¢ –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π /check\n"
        "‚Ä¢ –Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é –µ–≥–æ –∏ –¥–∞–º –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–∞\n\n"
        "–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—é:\n"
        "‚Ä¢ –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏\n"
        "‚Ä¢ –ó–∞–ø—Ä–æ—Å—ã –¥–µ–Ω–µ–∂–Ω—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤\n"
        "‚Ä¢ –§–∏—à–∏–Ω–≥–æ–≤—ã–µ —Å—Ö–µ–º—ã\n"
        "‚Ä¢ –û–±–º–∞–Ω—á–∏–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è\n\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /check —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑!"
    )


async def handle_help(event: MessageCreated, context: MemoryContext):
    await event.message.answer(
        "üìñ –ü–æ–º–æ—â—å\n\n"
        "–ö–æ–º–∞–Ω–¥—ã:\n"
        "/start - –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞\n"
        "/help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
        "/check - –Ω–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π\n\n"
        "üí¨ –í –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö:\n"
        "1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /check —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–±–æ—Ä\n"
        "2. –ü—Ä–∏—Å—ã–ª–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–º—É\n"
        "3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è\n\n"
        "üë• –í –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–∞—Ö:\n"
        "1. –ù–∞–∂–º–∏—Ç–µ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n"
        "2. –í—ã–±–µ—Ä–∏—Ç–µ '–û—Ç–≤–µ—Ç–∏—Ç—å'\n"
        "3. –ù–∞–ø–∏—à–∏—Ç–µ /check\n"
        "4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n"
        "5. –ü–æ–ª—É—á–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ —Ä–∏—Å–∫–∞\n\n"
        "–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–ª–∏—á–∞–µ—Ç —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–æ–≤ –ø–æ ID"
    )


async def handle_check(event: MessageCreated, context: MemoryContext):
    chat_type = get_chat_type(event)

    if chat_type == "group":
        if (
            hasattr(event.message, "link")
            and event.message.link
            and hasattr(event.message.link, "type")
            and str(event.message.link.type) == "MessageLinkType.REPLY"
        ):

            await start_group_check_session(event, context)
        else:
            await context.clear()
            await event.message.answer(
                "üîç –ö–æ–º–∞–Ω–¥–∞ /check\n\n"
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–æ–≤–æ–º —á–∞—Ç–µ.\n\n"
                "–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:\n"
                "1. –ù–∞–∂–º–∏—Ç–µ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n"
                "2. –í—ã–±–µ—Ä–∏—Ç–µ '–û—Ç–≤–µ—Ç–∏—Ç—å'\n"
                "3. –ù–∞–ø–∏—à–∏—Ç–µ /check\n"
                "4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n\n"
                "–Ø –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É—é —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –¥–∞–º –æ—Ü–µ–Ω–∫—É —Ä–∏—Å–∫–∞ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–∞."
            )
    else:
        await context.clear()
        await context.update_data(
            is_collecting=True,
            session_owner=event.from_user.user_id,
            messages=[],
            chat_type="private",
        )

        from maxapi.types import CallbackButton, ButtonsPayload

        buttons = [
            [
                CallbackButton(text="‚úÖ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Å–ª–∞–ª", payload="complete"),
                CallbackButton(text="‚ùå –û—Ç–º–µ–Ω–∞", payload="cancel"),
            ]
        ]

        buttons_payload = ButtonsPayload(buttons=buttons).pack()

        await event.message.answer(
            "üîç –ù–∞—á–∏–Ω–∞—é —Å–±–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.\n\n"
            "–ü—Ä–∏—Å—ã–ª–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–º—É. –í—Å–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:\n"
            "‚Ä¢ –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç\n"
            "‚Ä¢ –ü–µ—Ä–µ—Å–ª–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\n"
            "‚Ä¢ –û—Ç–≤–µ—Ç—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è\n\n"
            "–ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—Ç–µ, –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.",
            attachments=[buttons_payload],
        )
